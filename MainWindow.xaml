<Window x:Class="SPP2LetterSearch.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:SPP2LetterSearch"
        Title="SPP2 Letter Search" Height="800" Width="1200"
        WindowStartupLocation="CenterScreen"
        Background="#F5F5F5"
        Icon="AppIcon.ico">
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter" />
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Folder Selection Section -->
        <Border Grid.Row="0" Background="White" Padding="15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <TextBlock Text="Letter Folder:" VerticalAlignment="Center" Margin="0,0,10,0" FontWeight="Bold" />
                <TextBox Grid.Column="1" Text="{Binding SelectedFolder, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                         Height="32" VerticalContentAlignment="Center" Margin="0,0,10,0" Padding="8"
                         Background="White" Foreground="#333" BorderThickness="1" BorderBrush="#CCCCCC" />
                <Button Grid.Column="2" Command="{Binding BrowseFolderCommand}" 
                        Content="Browse" Height="32" Padding="15,0" Margin="0,0,10,0"
                        Background="#0078D4" Foreground="White" FontWeight="Bold" />
                <Button Grid.Column="3" Command="{Binding BuildIndexCommand}" 
                        Content="Build/Update Index" Height="32" Padding="15,0" Margin="0,0,10,0"
                        Background="#107C10" Foreground="White" FontWeight="Bold" />
                <Button Grid.Column="4" Command="{Binding RebuildIndexCommand}" 
                        Content="Rebuild Index" Height="32" Padding="15,0"
                        Background="#D83B01" Foreground="White" FontWeight="Bold" />
            </Grid>
        </Border>

        <!-- Index Progress Section -->
        <Border Grid.Row="1" Background="White" Padding="15" Visibility="{Binding IsIndexing, Converter={StaticResource BoolToVisibilityConverter}}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                
                <TextBlock Grid.Row="0" Grid.Column="0" Text="{Binding ProgressText}" FontWeight="Bold" />
                <Button Grid.Row="0" Grid.Column="1" Command="{Binding CancelCommand}" 
                        Content="Cancel" Height="28" Padding="15,0" Background="#D83B01" 
                        Foreground="White" FontWeight="Bold" />
                
                <ProgressBar Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" 
                             Value="{Binding IndexProgress}" Height="20" Margin="0,8,0,0"
                             Background="#E1E1E1" Foreground="#107C10" />
                
                <TextBlock Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2" 
                           Text="{Binding ProgressText}" FontSize="12" Foreground="#666" Margin="0,8,0,0" />
            </Grid>
        </Border>

        <!-- Search Section -->
        <Border Grid.Row="2" Background="White" Padding="15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                
                <TextBox Grid.Column="0" Text="{Binding SearchQuery, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         Height="36" VerticalContentAlignment="Center" Margin="0,0,10,0" Padding="10,0"
                         Foreground="#333" Background="White" BorderThickness="1" BorderBrush="#CCCCCC"
                         KeyDown="SearchBox_KeyDown" />
                
                <Button Grid.Column="1" Command="{Binding SearchCommand}" 
                        Content="Search" Height="36" Padding="20,0" Margin="0,0,10,0"
                        Background="#0078D4" Foreground="White" FontWeight="Bold" />
                
                <CheckBox Grid.Column="2" Content="Open PDF on double-click" 
                          IsChecked="{Binding OpenOnDoubleClick, Mode=TwoWay}"
                          VerticalAlignment="Center" FontWeight="Bold" />
            </Grid>
        </Border>

        <!-- Results Grid -->
        <Border Grid.Row="3" Margin="0,10,0,0">
            <DataGrid ItemsSource="{Binding SearchResults}" AutoGenerateColumns="False"
                      GridLinesVisibility="Horizontal" BorderBrush="#CCCCCC" BorderThickness="1"
                      Background="White" MouseDoubleClick="ResultsGrid_MouseDoubleClick">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Letter No" Binding="{Binding LetterNo}" Width="100" />
                    <DataGridTextColumn Header="File Name" Binding="{Binding FileName}" Width="200" />
                    <DataGridTextColumn Header="Score" Binding="{Binding Score, StringFormat=N2}" Width="80" />
                    <DataGridTextColumn Header="Snippet" Binding="{Binding Snippet}" 
                                       Width="*" MinWidth="300" />
                    <DataGridTemplateColumn Header="Actions" Width="100">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Button Content="Open" 
                                        Command="{Binding DataContext.OpenPdfCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                        CommandParameter="{Binding}"
                                        Height="24" Padding="10,0" Background="#0078D4" 
                                        Foreground="White" FontSize="12" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </Border>

        <!-- Status Bar -->
        <Border Grid.Row="4" Background="#F5F5F5" Padding="15" BorderThickness="0,1,0,0" BorderBrush="#CCCCCC">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Text="{Binding StatusMessage}" Foreground="#333" />
                <TextBlock Grid.Column="1" Text="{Binding SearchResults.Count, StringFormat='Results: {0}'}" 
                           Foreground="#666" FontWeight="Bold" />
            </Grid>
        </Border>
    </Grid>
</Window>
